# Security

📖 **Contents**

- Security
  - [패스워드는 서버에 어떻게 보관될까](#패스워드는-서버에-어떻게-보관될까)
  - [JWT 토큰이란](#jwt-토큰이란)
  - [OAuth란](#oauth란)

* * *

## 패스워드는 서버에 어떻게 보관될까
- **단방향 해시 함수를 사용하여 패스워드를 암호화해서 보관한다.**
- 단뱡향 해시 함수는 어떤 수학적 연산이나 알고리즘에 의해 원본 데이터를 매핑시켜 완전히 다른 암호화된 데이터로 변환시키는 것을 의미한다. 이 변환을 해시라고 하고, 해시에 의해 암호화된 데이터를 다이제스트(digest)라고 한다. 이렇게 DB에 저장된 다이제스트는 DB가 해킹당한다 하더라도 단방향으로 해싱된 문자이기 때문에 복호화를 할 수 없다.

- [관련 블로그](https://st-lab.tistory.com/100)


* * *

## JWT 토큰이란
- 세션과 JWT 토큰 둘 다 모두 "인증"이 아닌 "권한" / "인가"와 관련된 기술이다.

- **먼저 세션으로 권한 및 인가를 허용하는 과정은 다음과 같다.**
  - 사용자가 로그인에 성공하면 세션을 발행
  - 그 세션 id를 브라우저에 쿠키로 저장하고 서버 메모리 또는 데이터베이스에도 세션을 저장
  - 인가가 필요한 요청을 보낼 때 서버에 쿠키인 세션 id를 보냄 
  - 서버에서 메모리 또는 데이터베이스에 저장된 값과 쿠키인 세션 id와 비교해서 맞다면 권한 및 인가를 허용

- **반면에 JWT(JSON Web Token)이란,** 
  - 예를 들어, eyJhbGciOiJIUzI1NiIsIn 이러한 형식이다. 사용자가 로그인을 하면 서버에서 토큰을 발행해주는 것으로, 이 토큰을 서버가 기억하고 있지 않는다.
    - 인가가 필요한 요청을 보낼 때 사용자는 해당 토큰을 보내야 한다.
  - 이 토큰은 암호화된 3가지 데이터를 이어붙인 형태(aaa.bbb.ccc)로 구성되어 있다. 
  - 첫번째로는 헤더 : 세번째 서명 값을 만드는데 사용하는 알고리즘과 type이 들어간다. ex) HS256 / JWT
  - 두번째로는 페이로드 : 토큰이 갖는 데이터를 의미.
  - 세번째로는 서명 : 1번 헤더에 정의된 알고리즘을 통해 암호화한 비밀 값으로 서버만 알고 있음

- **JWT 단점**
  - 세션처럼 모든 사용자들의 상태를 기억하고 있지 않기 때문에 기억하는 대상들의 상태를 항상 제어할 수 없다.
  - 이미 발행한 토큰이 해커한테 넘어가도 토큰을 무효화할 방법이 없다.

- **해결책으로 로그인 시 accessToken / refreshToken 이렇게 2개의 토큰을 발행해준다.** 
  - accessToken은 매번 인가받을 때 사용하는 토큰(수명이 짧다)
  - refreshToken은 accessToken의 수명이 다했을 때 accessToken을 재발행 받기 위한 토큰(보통 2주 정도 유지)
  - 누군가를 로그아웃 시키려면 refeshToken을 db에서 지워버리면 되는데 그래도 accessToken의 수명 동안은 바로 차단할 방법은 없음

- [관련 블로그](https://velog.io/@syoung125/JWT-%ED%86%A0%ED%81%B0%EC%9D%B4%EB%9E%80)


* * * 

## OAuth란
- 사용자가 어떤 애플리케이션을 이용할 때, 비밀번호를 입력하지 않고 OAuth를 제공하는 애플리케이션의 계정 정보를 공유하여 접근 권한을 부여할 수 있는 수단
- OAuth가 사용되기 전에는 각 애플리케이션이나 웹 사이트마다 개별적인 인증 방식으로 아이디와 비밀번호를 사용하여 로그인 => OAuth는 제각각인 인증방식을 표준화한 것

