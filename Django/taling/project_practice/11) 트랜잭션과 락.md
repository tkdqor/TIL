## 트랜잭션과 락


### 결제 수행 과정
1. 고객이 원하는 일자와 시간을 선택
2. 예약정보입력 페이지로 이동 후 예약자명, 전달사항을 적는 폼 페이지에서 관련 정보를 입력
3. 예약 보증금 결제 처리 -> 이 때 결제처리과정을 거치게 됨
   - **a) PG사에 결제 요청** / PG사는 Pay Gateway의 약자로 여러가지 결제 인증 업체들이 있다. 우리가 계죄이체할 때, 한국에 있는 20개가 되는 은행들과 연동을 해야 계좌이체가 발생한다. 카드결제 시, 카드사 같은 경우도 
     10개가 넘어간다. 이렇게 많은 결제 업체들, 즉 결제 수단을 제공하는 그런 회사들이 있다. 이 회사들에 있는 정보랑 통신들을 전부 다 매핑을 해서 우리가 이커머스 사이트를 운영할 때 결제 모듈을 불러와서 
     쓸 수 있게 해주는 게 바로 PG사의 역할이다. 따라서 PG사의 경우에는, 우리가 그냥 PG사에 연동만 해놓으면 그러한 다양한 결제 수단 업체들에 대한 요청을 보낼수가 있고, 인증도 걸쳐서 결제를 진행할 수
     있게 되는 것이다. 그래서 이 a 단계는 결제창을 여는것부터 시작한다. 그래서 우리가 상품을 구매할 때 --> 결제 화면이 열리면서 거기서 카드를 선택하거나 은행을 선택하거나 했을 것이다. 그렇듯이 그렇게
     창을 여는 단계라고 생각하면 된다. 
   - **b) 다음으로는 카드 결제의 경우 카드 인증 단계가 있다. 또한, 계좌이체의 경우 공인인증서를 인증하는 단계가 있을 수 있다. 휴대폰 결제는 휴대폰 인증이 있고 상품권 결제는 상품권 인증이 있다.** 
     가상계좌의 경우에만, 한번에 끝나기 때문에 가상계좌는 별도의 인증 단계를 거치지 않는다. 보통 이러한 인증수단들은, 예를 들어 카드 결제를 할 경우에는 현대카드이면 현대카드, 삼성카드면 삼성카드, 
     롯데카드면 롯데카드, 이런식으로 해당 카드 업체에 서버를 통해서 인증이 이루어지게 된다. 
   - **c) 다음으로는 데이터베이스에 예약 내역을 입력하는 단계이다. 해당 DB는 우리쪽 DB를 의미한다.** 인증된 값을 우리의 웹 서비스에서 실제로 결제할 금액과 매핑을 해서 검사를 한 뒤에, 이 데이터가 
     유효하게 완성이 되어있으면,
   - **d) 최종적으로 결제 승인 요청을 PG사한테 보내면, 그 PG사가 위에서 인증한 카드사나 은행들한테 인출을 해달라고 연락을 하는 단계가 된다.** 
