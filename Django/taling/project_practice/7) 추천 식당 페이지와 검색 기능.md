## 추천 식당 페이지와 검색 기능

### 키워드 검색 기능
- https://docs.djangoproject.com/en/4.0/ref/models/querysets/ 해당 django 공식 문서를 보면, Field lookup이라는 것이 있다. 여기서 여러가지가 있지만, 키워드 검색의 경우
  contains라는 조건이 있고 startswith이라는 조건과 endswith이라는 조건이 있다. 이 때, 이 조건들 앞에 i라는 것이 붙어있으면 --> 대소문자를 무시하는 조건이 되기도 한다. 우리가 앞서 배웠던 
  B Tree를 고려하면 startswith이 조금 더 제대로된 인덱스를 탈 것이라고 유추할 수 있다. 
- 검색은 카테고리를 조건으로 걸 수도 있고 키워드나 둘 다 가능하다. 그래서 search View 라는 걸 만들어서 이걸 조건으로 받도록 구현을 해보자.


### Search View 생성
- views 디렉터리 - main.py에서 코드를 생성하자.

```python
from django.core.paginator import Paginator
from ..models import Recommendation, Restaurant, Category
...

# 검색기능을 위한 View
class SearchView(TemplateView):
    template_name = 'main/search.html'

    def get_context_data(self, **kwargs):
        page_number = self.request.GET.get('page', '1')
        keyword = self.request.GET.get('keyword')
        category_id = self.request.GET.get('category')
        
        query_sets = Restaurant.objects.filter(visible=True).order_by('-created_at')
        if keyword:
            query_sets = query_sets.filter(name__istartswith=keyword)
        if category_id:
            category = Category.objects.get(pk=int(category_id))
            query_sets = query_sets.filter(category=category)
        
        restaurants = query_sets.all()
        paginator = Paginator(restaurants, 12)
        
        paging = paginator.get_page(page_number)
        
        return {
            'paging': paging,
        }
```


- TemplateView를 상속받는 SearchView를 만들어주고 template이름을 정해주자. 그리고 get_context_data 메서드 내부에는 검색결과의 페이지네이션을 적용하기 위해서 page_number 변수를 request에서 GET 파라미터로
  page 값을 받고, 없을 경우에는 1페이지부터 시작하도록 설정해준다.
- 그 다음에는 keyword 값도 받는다. 기본적으로 검색결과 라는 건, GET으로 받게 된다. 보통 POST로 받지 않는데 그 이유는, 검색결과 화면을 우리가 url를 그대로 복사해서 보존하거나 공유하는 경우가 많기 때문이다.    
  또한 즐겨찾기에 추가하는 경우도 있다. 그래서 특정 검색 결과는, POST처럼 일시적으로 데이터가 전달되고 끝나는 그런 형태가 아니라 --> 쿼리 내용들이 url에 보존이 되야되는 경우이기 때문에 GET를 사용해서   
  페이지를 띄우게 된다. 그래서 우리도 GET 파라미터를 활용하자.
- keyword는 검색할 키워드 값을 받는 것이다. / category_id도 받는다. 어떤 카테고리에 속해있는지 그 pk값을 GET으로 받는다. 
- 그 다음에는 이제 queryset를 작성하자. Restaurant 모델을 import하고 visible 조건으로 필터하고 생성일 내림차순으로 조건문을 만들어준다. 아직 DB에 실행은 안된 것이다.    
  - 그리고 if문으로 keyword 변수에 값이 있을 때, 즉 none이 아닐 때는 filter를 한번 더 걸어서 keyword로 시작하는 이름을 가져와준다.
  - 또한, if문으로 category가 있을 때도 해준다. 받은 category_id로 Category 모델에서 해당 인스턴스를 찾아준다. 그리고 그 찾은 인스턴스를 Restaurant 모델에서 필터로 찾아주는 것이다.
- 그리고 마지막으로 restaurants = query_sets.all() 이 코드를 입력해서 해당 조건에 있는 query_set를 전부 가져오는 식으로 마무리 한다.  
  - 추가로, import로 Paginator 객체를 불러오자. 그리고 Paginator 객체를 사용하여 쿼리셋을 집어넣고 paginator = Paginator(restaurants, 12) 이렇게 입력하면 한 페이지에 12개를 보여주겠다는 의미이다.
  - 그 다음에는 paging변수를 사용해 객체를 가져오고 우리가 받은 page_number를 띄울 수 있도록 get_page 메서드를 사용해준다.

- **지금까지의 과정처럼, filter 메소드를 중첩하게 되면 --> and 조건으로 중첩이 된다.**
