## 마이 페이지
- django의 기본 유저를 사용하면 username 필드가 unique여야 한다. 
- 소셜 로그인을 하면 username에 소셜 계정의 닉네임이 들어가는 이슈가 발생한다. 
  - 이러한 문제를 해결하기 위해 abstractuser 라는 걸 상속받아 새로운 모델로 사용할 수도 있고, all auth의 어댑터를 재구현해서 username을 이메일로 업데이트 하는 방법도 있다. 전자는 너무 많은 부분을 
    수정해야 되니까 후자로 해보자.
    
- models.py로 가서 새로운 모델을 추가해준다.

```python
from allauth.socialaccount.adapter import DefaultSocialAccountAdapter
from allauth.socialaccount.models import SocialAccount
import uuid
...

class CustomSocialAccountAdapter(DefaultSocialAccountAdapter):
    def populate_user(self, request, sociallogin, data):
        user = super().populate_user(request, sociallogin, data)
        user.username = user.email[:30]
        if User.objects.filter(username=user.username).exists():
            user.username = str(uuid.uuid4())


```

- 이렇게 DefaultSocialAccountAdapter를 상속받는 클래스를 정의한다. **from allauth.socialaccount.adapter import DefaultSocialAccountAdapter 이렇게 import를 해주면 된다. 
  이건 소셜 account가 우리쪽 DB에 입력될 때 실제 기존 User 모델과 어떻게 데이터를 저장하고 처리할지 정하는 어댑터라고 보면 된다.** 우리가 이걸 재구현해서 소셜 데이터가 들어올 때, 우리쪽에 User 
  데이터를 넣는 과정에서 변환하는 과정을 수정하는 것이다. 
- 그리고 SocialAccount 모델도 가져오고, 우리가 겹치지 않는 username을 만들기 위해서 uuid도 import를 해주자. 

- CustomSocialAccountAdapter 클래스에서는 populate_user라는 걸 오버라이드 한다. 이게 user를 처리하는 메소드가 된다. 일단 super클래스에 있는 걸 그대로 호출하고, 그 user의 username 값을
  user.email 이렇게 이메일로 넣어주는 것이다. 그리고 필드자체가 30자까지만 들어가니까 30자로 짤라서 넣어준다.
  - 그 다음에는 user의 username이 동일한 게 있다면, uuid로 교체해서 겹치지 않도록 설정해준다. 
