## 7) 테스트
- 어떤 소프트웨어를 공개하기 전에 제대로 테스트가 필요
- 테스트 코드는 실행단위별로 작성해야 하므로, 2가지 레벨에서 구현할 수 있다.
  - 통합 테스트 : 뷰 하나를 호출하는 것에 대한 테스트 / 즉, 하나의 API, 하나의 HTTP 요청이 우리 서버로 들어오고 나가는데 까지를 거쳐가는 모든 코드들을 다 테스트 / 하나의 기능을 동작시키는 모든 코드들을 테스트 하는 것 
  - 단위 테스트 : 함수나 메소드 하나를 호출하는 것에 대한 테스트


### 단위 테스트 실습
- 먼저 settings.py에 가서 DATABASES 부분에 추가해주자.

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'HOST': 'tablebookings.c1uzjwt0ilcb.ap-northeast-2.rds.amazonaws.com',
        'PORT': 3306,
        'NAME': 'tablebooking',
        'USER': 'tablebookings',
        'PASSWORD': 'qwaszxqwer1!',
        'TEST': {
            'NAME': 'tablebooking_test'
        }
    }
}
```

- 이렇게 TEST라는 키와 딕셔너리 값을 넣어줘야 한다.

- **그리고 이제 templatetags - booking_tags.py에 있는 convert_status_korean 함수가 제대로 동작하는지를 확인해보자.** (단위 테스트)
  - web 앱 디렉터리 내부에 보면 tests.py라는 파일이 만들어져 있다. 여기에 코드를 입력해서 세팅을 해보자.

```python
from django.test import TestCase
from django.test import Client
from django.urls import reverse

from .models import Booking, Restaurant, Category
from .templatetags.booking_tags import convert_status_korean


class BookingTagsTest(TestCase):
    def setUp(self) -> None:
        self.cases = [
            (Booking.PayStatus.READY, "결제 대기"),
            (Booking.PayStatus.CANCELED, "예약 취소"),
            (Booking.PayStatus.FAILED, "예약 실패"),
            (Booking.PayStatus.PAID, "예약 완료"),
        ]
    
    def test_convert_status_korean(self):
        for case in self.cases:
            result = convert_status_korean(case[0])
            self.assertEqual()
            self.assertEqual(case[1], result)
```

- **우리가 단위 테스트를 하려고 하는 함수인 convert_status_korean를 import로 가지고 온다.** 
- **그리고 booking_tags에 있는 함수들을 호출하는 클래스를 만들어주는데, 이 때 테스트를 하기 위해서는 꼭 TestCase를 import 해야 한다.** 
  - 그리고 그 안에는 setUp이라는 함수를 구현해야 한다. 이 함수는 해당 테스트를 수행하기 직전에 미리 사전에 준비해야되는 사전 작업들을 여기에 정의해둔다. 
  - 그래서 여기에 각각의 케이스에 대해서 매핑되는 규칙들을 정의해주자. 
  - 우리가 convert_status_korean 함수가 작동하는 것에 대해서 의도한 내용들이 있을텐데, 그 의도한 내용을 self.cases에 (Booking.PayStatus.READY, "결제 대기") 이렇게 괄호안에 왼쪽은 input / 오른쪽은 Output으로 해서 튜플로 하나를 정의해서 cases에 넣어준 것이다.
  - 그래서 4가지 결제 상태에 대한 우리의 의도한 내용들을 전부 튜플로 정의해준다.

- setUp이라는 함수는 해당 클래스가 처음에 뜰 때 미리 위와같이 케이스를 정의해주거나 미리 준비해야할 데이터베이스를 정리해두거나 그럴 때 사용하는 메소드이다. 
- 그래서 이 테스트를 django에서 실행시키면 setUp이 무조건 먼저 실행이 되고 -> 그 다음에 내가 추가로 실행할 함수들을 그 밑에다가 정의할 수 있다. 
  - **그래서 보통 python 파일 1개 당 --> test.py의 클래스 1개로 매칭시켜서 테스트를 많이 작성한다. 그래서 해당 파일 1개의 함수의 개수만큼 test.py 클래스 내부에 메소드가 늘어나게 된다.**
  - **그래서 이 클래스가 실행이 될 때, setUp 메소드가 먼저 실행되고 그 밑에 있는, 우리가 정의한 메소드들이 실행되는 것이다.**
  - 밑에 우리가 정의하는 메소드들은 보통 test라는 이름으로 시작하는 것이 좋다.

- **test_convert_status_korean라는 함수 내부에 for cases in self.cases: 이렇게 함으로써 -> setUp에서 미리 정의한 테스트 케이스들을 여기서 쓸 수 있게 되는 것이다.** 
  - 그리고 result = convert_status_korean(case[0]) 이렇게 해서 함수를 호출하고 튜플의 0번을 대입해준다. 
  - self.assertEqual() 이렇게 assertEqual이라는 메소드가 있는데, TestCase에서 기본적으로 제공하고 있는 메소드이다. 이건 첫번째와 두번째가 값이 동일한지를 평가해준다. 
  - **self.assertEqual(case[1], result) 이렇게 내가 예상한 결과(테스트 결과)와 / 실제 함수를 호출했을 때 나오는 값이 동일한지 확인해주자.**

- **그래서 동일하면 문제없이 통과가 되고 / 동일하지 않으면 이 assertEqual에서 테스트가 실패했다는 exception을 발생시킨다.**
