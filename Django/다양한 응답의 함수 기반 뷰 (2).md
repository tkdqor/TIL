## 다양한 타입의 HttpResponse


### 엑셀 파일 다운로드 응답
```python
from django.http	import HttpResponse
from urllib.parse	import quote

def response_excel(request):
    filepath	=	'/other/path/excel.xls'
    filename	=	os.path.basename(filepath)
    
    with open(filepath,	'rb')	as f:
        response	=	HttpResponse(f,	content_type='application/vnd.ms-excel')
        
        #	브라우저에 따라 다른 처리가 필요
        encoded_filename	=	quote(filename)
        response['Content-Disposition']	=	"attachment;	filename*=utf-8''{}".format(encoded_filename)
   
    return response
    
```

- 어떤 View가 있을 때, filepath처럼 엑셀 파일을 직접 읽어서, filename처럼 경로를 만들고 -> 해당 파일을 read binary 모드로 읽어서 파일 객체를 f로 획득한다. 그리고 그 객체르 HttpResponse의 첫번째 
  인자로 지정할 수 있다.
  - 굳이 f.read() 이렇게 호출해서 byte 데이터로 메모리에 올린 다음에 그 내용을 넘기지 않아도 내부적으로 읽기를 시도하기 때문에 위의 코드처럼 하면 된다. 혹은 openpyxl과 같은 라이브러리를 통해서 동적으로
    엑셀파일을 만들 수 있다.
    
- response는 엑셀파일의 내용을 참조하는 response가 된다. 
- response 관련, 만약 엑셀파일에 대해서 첨부를, 파일 다운로드 다이얼로그(화면에 보여지는 팝업형태의 창)를 브라우저에 띄워주려면 응답 헤더에 'Content-Disposition'을 지정해주면 된다. 그리고 여기에 
  attachment와 filename으로 지정해주면 다운로드가 된다. 이와 관련해서 직접 HttpResponse를 쓰기 보다는 -> django.http.FileResponse를 활용하면 좀 더 수월하게 처리할 수 있다. https://github.com/django/django/blob/3.0.2/django/http/response.py 

- Content-Disposition 헤더의 filename 매개 변수를 HTTP로 인코딩하는 방법 : https://code.i-harness.com/ko-kr/q/16d6f


### Pandas를 통한 CSV 응답 생성
- python에서 데이터 전처리, 데이터 분석을 할 때 사용하는 라이브러리.

```python
import pandas	as pd
from io	import StringIO
from django.http	import HttpResponse


def response_csv(request):
    df	=	pd.DataFrame([
          [100,	110,	120],
          [200,	210,	220],
          [300,	310,	320],
    ])
    
    io	=	StringIO()
    df.to_csv(io)
    io.seek(0)	#	끝에 있는 file	cursor를 처음으로 이동
    
    response	=	HttpResponse(io,	content_type='text/csv')
    response['Content-Disposition']	=	"attachment;	filename*=utf-8''{}".format(encoded_filename)
    return response

```

- 데이터 분석을 안하고 django만 하는데 굳이 알아야 될까라고 생각할 수 있지만, 우리가 엑셀을 많이 활용하고 있고 실제 프로그램을 통해서 다양한 2차원 데이터, 엑셀의 행과 열의 2차원 데이터를 실제 로직으로 처리할
  일이 많다. 그런 부분을 Pandas에서 불러와서 Pandas의 DataFrame를 통해 처리하면 훨씬 수월하게 처리할 수 있다.
  - 또한 CSV나 엑셀 포맷이나 혹은 내가 원하는 특정 DB로 insert까지 Pandas를 통해서 수월하게 할 수 있다.
