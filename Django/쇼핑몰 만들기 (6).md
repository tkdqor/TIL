## 상품 1개 조회 화면에서 장바구니 버튼으로 장바구니 추가하기

### views.py 수정
```python
from django.http import HttpResponse, JsonResponse
...

# 장바구니 추가 기능
def updatedItem(request):
    return JsonResponse('Item added', safe=False)
```

- 이렇게 views.py에서는 JsonResponse를 추가로 import하고 updatedItem이라는 함수를 생성해준다.


```python
...
urlpatterns = [
  path('update_item/', views.updatedItem, name='update_item'),
]  
```

- 그리고 post앱 디렉터리에 있는 urls.py에서 위에서 생성한 함수를 연결하는 url을 추가로 설정해주기. 그러면 브라우저에 "Item added"가 출력된다.


### js파일 
- 그리고 우리는 js파일을 통해 로그인 된 사용자의 경우, 장바구니 버튼을 누르면 로그인 된 사용자인 것을 알 수 있었다. 추가로 함수를 만들어서 장바구니 버튼을 클릭했을 때 -> 위에서 생성한 views.py의 updatedItem 함수에다가 product의 ID와 action을 전달해보자.

```javascript
var updatedBtns = document.getElementsByClassName('cart-update')

for(var i = 0 ; i < updatedBtns.length; i++){
    updatedBtns[i].addEventListener('click', function(){
        var postID = this.dataset.post
        var action = this.dataset.action
        console.log('postID:',postID , 'action:',action)
        console.log('사용자:',user)
        if (user === 'AnonymousUser'){
            console.log('로그인이 되지 않았습니다.')
        }else{
            updateUserOrder(postID,action)
        }
    })
} 

function updateUserOrder(postID,action){
    console.log('로그인 되었으니 정보를 보냅니다.')

    var url ='/update_item/'                  // 우리가 urls.py에서 설정한 url를 입력
    fetch(url,{                               // fetch()를 이용해서 정보를 views.py로 전달  
        method: 'POST',                       // 정보를 POST 방식으로 보내기 (장바구니를 생성하는 것이기 때문)
        headers:{
            'Content-Type':'application/json',  // json의 형태로 정보를 보내겠다는 것

        },
        body:JSON({'postID': postID, 'action': action})    // postID와 action를 JSON 형태의 정보로 보내주겠다는 의미                        
    })

    .then((response) =>{              // 데이터가 views.py로 잘 전달되었는지 확인하는 과정으로 views.py에서 return되는 response를 확인하는 것
        return Response.json()
    })  
    .then((data) =>{              // 우리가 받은 response를 data라고 해주고, console에 출력 해주기   
        console.log('data:', data)
    })                                             
}
```

- 기존의 작성한 js코드를 수정하고 밑에다가 추가로 새로운 함수를 설정하는 것이다. 그래서 만약 유저가 비로그인 사용자가 아닐 경우, 우리가 밑에 생성한 함수를 실행시키라는 것이다.
- 새로 생성한 함수는 ....

- 그런데 이렇게 POST방식으로 fetch를 이용해서 정보들을 views.py로 보낼 때, django에서는 csrf_token를 사용해야 한다. 
  - https://docs.djangoproject.com/en/3.2/ref/csrf/ 해당 공식 문서에 나와있는 코드를 base.html에 먼저 추가해야 한다. base.html의 head 사이에 -> <script></script> 사이에 해당 코드를 추가하자.

```html
<!-- 자바스크립트 코드 -->
    <script type="text/javascript">
        var user = '{{request.user}}'

        // 자바스크립트 csrf_token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

    </script>
```





-     fetch 코드 headers 부분에 
