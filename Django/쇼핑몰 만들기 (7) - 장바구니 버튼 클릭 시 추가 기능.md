## 장바구니 버튼 후 화면 랜더링
- 지금까지 cart.js를 통해 장바구니 버튼을 클릭하면 -> post_id(product_id)와 action를 받아서 fetch를 사용해 데이터들을 보내줄 수 있었는데, view 함수를 수정해서 화면에 출력할 수 있도록 해보자.
- cart.js에서 보내준 JSON 형태의 정보를 views.py에서 해석하기 위해 JSON를 import 하는 것.

```python
import json

# 장바구니 추가 기능
def updatedItem(request, post_id):
    data = json.loads(request.body)
    postID = data['postID']             # cart.js의 fetch -> body에서 정의한 변수의 이름과 같게 설정.
    action = data['action']
    print(data)                         # 장바구니 버튼을 클릭할 때 받은 데이터가 cart.js로부터 전달되는지 먼저 확인하기.
    print('postID:' , postID)           # 해당 정보들을 id와 action으로 구분지어서 확인하기.
    print('action:' , action)

    return JsonResponse('Item added', safe=False)
```

- **json.loads()** 함수는 -> json파일을 읽어서 딕셔너리 형태로 저장해주는 함수를 의미한다.
  - 그 다음엔, cart.js의 fetch에 body에서 정의한 변수의 이름으로 postID와 action 값을 새롭게 변수를 지정해서 가져온다.
  - print(data)로 실제로 딕셔너리 형태로 데이터가 저장되었는지 터미널에서 확인해보고 & postID와 action이라는 변수도 잘 저장되었는지 터미널로 확인하기.

- 이렇게 먼저 cart.js에서 정의한 변수를 views.py에서 설정해주고, 장바구니 버튼을 클릭할 때 설정된 데이터들이 cart.js를 거쳐 전달되는지 터미널에 출력해보면서 확인하는 과정이다.


```python
# 장바구니 추가 기능
def updatedItem(request, post_id):
    data = json.loads(request.body)
    postID = data['postID']             # cart.js에서 정의한 변수의 이름과 같게 설정.
    action = data['action']
    print(data)                         # 장바구니 버튼을 클릭할 때 받은 데이터가 cart.js로부터 전달되는지 먼저 확인하기.
    print('postID:' , postID)           # 해당 정보들을 id와 action으로 구분지어서 확인하기.
    print('action:' , action)

    customer = request.user.customer    # 로그인 된 해당 유저를 Customer 모델에서 가져온다는 의미(user모델에서 OneonOne관계로 customer모델로 접근)
    post = Post.objects.get(id=postID)  # 장바구니를 누른 해당 상품의 id로 Post DB에 저장되어있는 정보 가져오기.
    order, created = Order.objects.get_or_create(customer=customer, complete=False)
    # Order 모델에서 로그인 된 해당 customer의 order가 이미 있다면 -> 생성하지 말고 그냥 가져오기
    # 또한, complete=False로 설정했기 때문에 가져올 때 주문이 완료 되지 않은 정보만 가져오라는 의미인 것 같다! 
    orderItem, created = OrderItem.objects.get_or_create(order=order, product=post)     # OrderItem 모델에 order 필드와 product 필드에 생성..?

    if action == 'add':
        orderItem.quantity = (orderItem.quantity + 1)    # 만약 button을 누를 때 action이 add이면 orderItem 변수에 있는 db정보의 quantity를 1 증가 시키기.
    elif action == 'remove':
        orderItem.quantity = (orderItem.quantity - 1)    # 만약 button를 누를 때 action이 remove이면 orderItem 변수에 있는 db정보의 quantity를 1 감소 시키기.

    orderItem.save()      # 위에서 변경된 내용 저장.

    if orderItem.quantity <= 0:         # 만약 장바구니로 추가된 상품의 수량이 0과 같거나 작으면 해당 데이터 삭제
        orderItem.delete()

    return JsonResponse('Item added', safe=False)
```

- 그리고 ....

- 이렇게 코드를 작업해주면, 상품 1개 조회 페이지에서 장바구니 버튼을 누르는 순간 -> 장바구니 페이지에 해당 상품이 추가되는 것을 화면에서 확인할 수 있다.
